datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum EtatPaiement {
  NON_PAYE
  PAYE
}

model Apprenant {
  id        Int        @id @default(autoincrement())
  email     String     @unique
  nom       String
  prenom    String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  commandes Commande[]
}

model Formation {
  id        Int        @id @default(autoincrement())
  titre     String
  prix      Decimal    @db.Decimal(10, 2)
  formateur String     // ✅ NOUVEAU
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  lignes    CommandeEnFormation[]
}

model Commande {
  id            Int                   @id @default(autoincrement())
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt

  etatEnvoi     String                // ✅ renommé
  etatPaiement  EtatPaiement           // ✅ enum

  apprenantId   Int
  apprenant     Apprenant              @relation(fields: [apprenantId], references: [id])

  lignes        CommandeEnFormation[]
}

model CommandeEnFormation {
  commandeId Int
  formationId Int
  quantite   Int

  commande   Commande  @relation(fields: [commandeId], references: [id], onDelete: Cascade)
  formation  Formation @relation(fields: [formationId], references: [id], onDelete: Restrict)

  @@id([commandeId, formationId])
}